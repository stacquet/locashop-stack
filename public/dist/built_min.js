angular.module("locashopApp",["uiGmapgoogle-maps","llNotifier","cgBusy","ngImgCrop","ui.router","angularFileUpload","appRoutes","ui.tinymce","ngResource"]),angular.module("appRoutes",[]).config(function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"app/home/home.html"}).state("inscription",{url:"/inscription",templateUrl:"app/inscription/inscription.html",controller:"inscriptionController as vm"}).state("login",{url:"/login",templateUrl:"app/home/login.html"}).state("ferme",{url:"/ferme",templateUrl:"app/ferme/ferme.html",controller:"fermeController as vm"}).state("profil",{url:"/profil/:id_profil",templateUrl:"app/profil/profil.html"}).state("profil.infos",{url:"/infos",templateUrl:"app/profil/profilInfo.html",controller:"profilInfoController as vmProfil"}).state("profil.adresse",{url:"/adresse",templateUrl:"app/profil/profilMaps.html",controller:"profilMapsController as vmMaps"}).state("profil.mobile",{url:"/mobile",templateUrl:"app/profil/profilMobile.html"})}),function(){"use strict";function a(a,b,c,d){function e(){h.busy=d.login(h.user.email,h.user.password).success(function(c){a.userInfos=c.user,a.isLoggedIn=!0,b.path("/")}).error(function(a){console.log(a),h.messages=a.messages})}function f(){a.isLoggedIn||(h.busy=d.userInfos().success(function(b){a.userInfos=b,a.isLoggedIn=!0}))}function g(){h.busy=d.logout().success(function(){a.userInfos=null,a.isLoggedIn=!1,b.path("/")})}var h=this;h.login=e,h.logout=g,f()}angular.module("locashopApp").controller("homeController",a),a.$inject=["$rootScope","$location","notifier","homeService"]}(),function(){"use strict";function a(a){function b(){return a.get("/api/home/userInfos")}function c(){return a.get("/api/home/logout")}function d(b,c){return a.post("/api/home/login",{email:b,password:c})}var e={userInfos:b,logout:c,login:d};return e}angular.module("locashopApp").factory("homeService",a),a.$inject=["$http"]}(),function(){"use strict";function a(a,b,c){function d(){g.passwordEquals=g.user.password===g.user.passwordBis}function e(){g.busy=c.checkEmailAvailable(g.user.email).then(function(a){g.emailAvailable=a.data.checkEmailAvailable,g.userForm.email.$setValidity("notAvailable",g.emailAvailable)},function(){})}function f(){g.formSubmitted=!0,d(),g.passwordEquals&&g.userForm.$valid&&(g.busy=c.checkEmailAvailable(g.user.email).then(function(a){g.emailAvailable=a.data.checkEmailAvailable}).then(function(){g.userForm.$valid&&g.emailAvailable&&(g.loadingMessage="Inscription en base",g.busy=c.localSignup(g.user).then(function(){return g.loadingMessage="Envoi d'un email de vérification",c.emailVerification()}).then(function(){b.notify({template:"Nous vous avons envoyé un mail pour confirmer votre inscription"}),a.path("/")},function(){b.notify({template:"Nous n'avons pu vous envoyer un mail, veuillez contactez le support",type:"error"})}))}))}var g=this;g.passwordEquals=!0,g.emailAvailable=!0,g.loadingMessage="loading",g.formSubmitted=!1,g.checkPasswordEqual=d,g.checkEmailAvailable=e,g.localSignup=f}angular.module("locashopApp").controller("inscriptionController",a),a.$inject=["$location","notifier","inscriptionService"]}(),function(){"use strict";function a(a){function b(b){return a.post("/api/inscription/checkEmailAvailable",{email:b}).success(function(a){return console.log(a),a}).error(function(){})}function c(b){return a.post("/api/inscription/localSignup",b)}function d(){return a.get("/api/inscription/emailVerification")}var e={checkEmailAvailable:b,localSignup:c,emailVerification:d};return e}angular.module("locashopApp").factory("inscriptionService",a),a.$inject=["$http"]}(),function(){"use strict";function a(a){function b(b){return a.post("/api/user/1/adresse",{userProfil:b}).success(function(a){return console.log(a),a}).error(function(){})}var c={saveAdresse:b};return c}angular.module("locashopApp").factory("mapsService",a),a.$inject=["$http","$resource"]}(),function(){"use strict";function a(){function a(a,b,c){console.log(a),a.title=c.title,a.$watch(c.visible,function(a){$(b).modal(1==a?"show":"hide")}),$(b).on("shown.bs.modal",function(){a.$apply(function(a){a[c.visible]=!0})}),$(b).on("hidden.bs.modal",function(){a.$apply(function(a){a[c.visible]=!1})})}var b={template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{ title }}</h4></div><div class="modal-body" ng-transclude></div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:!1,link:a};return b}angular.module("locashopApp").directive("modal",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(){c.showModal=!c.showModal}function j(){p.busy=l().then(function(){g.notify({template:"Sauvegarde OK"})},function(a){g.notify({template:a,type:"error"})})}function k(){a.busy=h.get({id:d.id_profil}).$promise.then(function(a){p.userProfil=a,a.Photo&&(p.profilImage=a.Photo.chemin_webapp+"/"+a.Photo.uuid+".jpg")})}function l(){var a=f.defer(),b=p.profilImageChanged?o(p.profilImage):!1,c={url:"/api/profil/"+d.id_profil,fields:{userProfil:p.userProfil},file:b};return e.upload(c).success(function(){a.resolve()}).error(function(b){console.log("pas bon"),a.reject("error : "+b)}),a.promise}function m(){if(p.files){console.log(p.files);var a=p.files[0],b=new FileReader;b.onload=function(a){c.$apply(function(){p.uploadedImage=a.target.result,c.showModal=!0})},b.readAsDataURL(a)}}function n(){p.profilImage=p.croppedImage,p.profilImageChanged=!0,i()}function o(a){for(var b=atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=[],e=0;e<b.length;e++)d.push(b.charCodeAt(e));return new Blob([new Uint8Array(d)],{type:c})}var p=this;p.uploadedImage="",p.croppedImage="",p.profilImage="",p.profilImageChanged=!1,p.saveProfil=j,p.upload=l,p.crop=m,p.dataURItoBlob=o,p.toggleModal=i,p.updateProfilImage=n,p.userProfil={},c.showModal=!1,k(),p.options={language:"en",allowedContent:!0,entities:!1},c.$watch("vmProfil.files",function(){p.crop()})}angular.module("locashopApp").controller("profilInfoController",a),a.$inject=["$rootScope","$timeout","$scope","$stateParams","$upload","$q","notifier","profilService","mapsService"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){function j(){delete o.userProfil.Adresse}function k(){n(),o.userProfil.adresse=o.place,a.busy=h.saveAdresse(o.userProfil)}function l(){a.busy=i.get({id:c.id_profil}).$promise.then(function(a){if(o.userProfil=a,a.Photo&&(o.profilImage=a.Photo.chemin_webapp+"/"+a.Photo.uuid+".jpg"),o.userProfil.Adresse){var c=new google.maps.LatLngBounds,d=new google.maps.LatLng(o.userProfil.Adresse.coordonnee_y,o.userProfil.Adresse.coordonnee_x);c.extend(d),b.map.bounds={northeast:{latitude:c.getNorthEast().lat(),longitude:c.getNorthEast().lng()},southwest:{latitude:c.getSouthWest().lat(),longitude:c.getSouthWest().lng()}};var e={id:0,latitude:o.userProfil.Adresse.coordonnee_y,longitude:o.userProfil.Adresse.coordonnee_x};b.map.markers.push(e),b.map.zoom=12}})}function m(){console.log(b.map)}function n(){b.showModal=!b.showModal}var o=this;b.showModal=!1,o.saveAdresse=k,o.logMap=m,o.changeAdresse=j,e.doLog=!0,g.then(function(a){a.visualRefresh=!0,b.defaultBounds=new google.maps.LatLngBounds(new google.maps.LatLng(40.82148,-73.6645),new google.maps.LatLng(40.66541,-74.31715)),b.map.bounds={northeast:{latitude:b.defaultBounds.getNorthEast().lat(),longitude:b.defaultBounds.getNorthEast().lng()},southwest:{latitude:b.defaultBounds.getSouthWest().lat(),longitude:-b.defaultBounds.getSouthWest().lng()}},b.searchbox.options.bounds=new google.maps.LatLngBounds(b.defaultBounds.getNorthEast(),b.defaultBounds.getSouthWest())}),angular.extend(b,{selected:{options:{visible:!1},templateurl:"window.tpl.html",templateparameter:{}},map:{control:{},center:{latitude:47.472955,longitude:-.554351},zoom:10,dragging:!1,bounds:{},markers:[],idkey:"place_id",events:{idle:function(){},dragend:function(a){var c=a.getBounds(),d=c.getNorthEast(),e=c.getSouthWest();b.searchbox.options.bounds=new google.maps.LatLngBounds(e,d)}}},searchbox:{template:"searchbox.tpl.html",position:"top-left",options:{bounds:{}},parentdiv:"profilMapsControllerParent",events:{places_changed:function(a){var c=a.getPlaces();if(0!=c.length){for(var d,e=[],f=new google.maps.LatLngBounds,g=0;d=c[g];g++){var h={id:g,place_id:d.place_id,name:d.name,latitude:d.geometry.location.lat(),longitude:d.geometry.location.lng(),options:{visible:!1},templateurl:"window.tpl.html",templateparameter:d,adresse:d};e.push(h),f.extend(d.geometry.location)}b.map.bounds={northeast:{latitude:f.getNorthEast().lat(),longitude:f.getNorthEast().lng()},southwest:{latitude:f.getSouthWest().lat(),longitude:f.getSouthWest().lng()}},_.each(e,function(a){a.onClicked=function(){console.log(b),o.place=a.adresse,b.showModal=!0}}),b.map.markers=e,b.map.zoom=12}}}}}),l()}angular.module("locashopApp").controller("profilMapsController",a).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({v:"3.16",libraries:"places"})}]).run(["$templateCache",function(a){a.put("searchbox.tpl.html",'<input id="pac-input" class="form-control" type="text" placeholder="Rechercher votre adresse">')}]),a.$inject=["$rootScope","$scope","$stateParams","$timeout","uiGmapLogger","$http","uiGmapGoogleMapApi","mapsService","profilService"]}(),function(){"use strict";function a(a,b){var c=b("/api/profil/:id");return c}angular.module("locashopApp").factory("profilService",a),a.$inject=["$http","$resource"]}();